syntax = "proto3";

package media;

option go_package = "social-network/shared/gen/media;media";

// Upload request
message UploadImageRequest {
  // Raw file bytes
  bytes file_content = 1;
  // Original file name
  string filename = 2;      
}

// Upload response
message UploadImageResponse {
  int64 id = 1;
  // Detected MIME type            
  string mime_type = 2;
  // File size
  int64 size_bytes = 3;
  // MinIO bucket
  string bucket = 4;
  // MinIO object key
  string object_key = 5;
}

// Service definition
service MediaService {
  // Uploads and image to minIO and returns image Meta and storage info
  rpc UploadImage(UploadImageRequest) returns (UploadImageResponse);
  // Returns image meta and file in a chunked response
  rpc RetrieveImage(RetrieveImageRequest) returns (stream RetrieveImageResponse);
}

// Request
message RetrieveImageRequest {
  int64 image_id = 1;
}

// Metadata â€” mirrors your ImageMeta struct
message ImageMeta {
  int64 id = 1;
  string filename = 2;
  string mime_type = 3;
  int64 size_bytes = 4;
  string bucket = 5;
  string object_key = 6;
}

// File chunk
message ImageChunk {
  // raw bytes
  bytes data = 1;
}

// The streamed response
message RetrieveImageResponse {
  oneof payload {
    ImageMeta meta = 1;
    ImageChunk chunk = 2;
  }
}
